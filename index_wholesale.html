<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BusyWin — Stock (Wholesale column)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, Helvetica, sans-serif; padding: 18px; background:#f7f7f7 }
    table { border-collapse: collapse; width: 100%; background:white; box-shadow:0 1px 4px rgba(0,0,0,0.06) }
    th, td { padding: 8px 10px; border: 1px solid #eee; text-align:left; font-size:13px }
    th { background:#fafafa; position: sticky; top:0; z-index:2 }
    .small { font-size:12px; color:#666 }
    .stock-low { background: #fff7e6 }
  </style>
</head>
<body>
  <h2>BusyWin — Stock (Wholesale)</h2>
  <p class="small">This page reads <code>stock_data.js</code> in the same folder and shows <strong>Wholesale</strong> (Item_SelfVal_Price).</p>

  <div id="controls" style="margin-bottom:12px">
    <label>Search: <input id="q" placeholder="name, alias, code" /></label>
    <label style="margin-left:12px">Min stock: <input id="minStock" type="number" min="0" value="0" style="width:70px" /></label>
    <button id="refresh" style="margin-left:12px">Refresh</button>
  </div>

  <div style="overflow:auto; max-height:70vh">
    <table id="tbl">
      <thead>
        <tr>
          <th>#</th>
          <th>ItemName</th>
          <th>Alias</th>
          <th>Group</th>
          <th>MRP</th>
          <th>Sale Price</th>
          <th>Wholesale</th>
          <th>Stock</th>
          <th>LastSync</th>
        </tr>
      </thead>
      <tbody id="body"></tbody>
    </table>
  </div>

  <script>
    (function(){
      function render(items){
        const tbody = document.getElementById('body');
        tbody.innerHTML = '';
        const q = (document.getElementById('q').value||'').toLowerCase().trim();
        const minStock = Number(document.getElementById('minStock').value)||0;
        let idx=0;
        for(const it of items){
          if (q){
            const s = (it.ItemName+' '+it.ItemAlias+' '+it.ItemCode).toLowerCase();
            if (s.indexOf(q) === -1) continue;
          }
          const stockN = Number(it.Stock) || 0;
          if (stockN < minStock) continue;
          idx++;
          const tr = document.createElement('tr');
          if (stockN <= 2) tr.className = 'stock-low';
          tr.innerHTML = [
            `<td>${idx}</td>`,
            `<td>${it.ItemName||''}</td>`,
            `<td>${it.ItemAlias||''}</td>`,
            `<td>${it.GroupName||''}</td>`,
            `<td>${it.Item_MRP||''}</td>`,
            `<td>${it.Item_Sale_Price||''}</td>`,
            `<td>${(it.Item_SelfVal_Price===undefined? '': it.Item_SelfVal_Price) || ''}</td>`,
            `<td>${it.Stock||''}</td>`,
            `<td>${it.LastSync||''}</td>`
          ].join('');
          tbody.appendChild(tr);
        }
        if(idx===0){
          tbody.innerHTML = '<tr><td colspan="9" class="small">No items match the filter</td></tr>';
        }
      }

      function loadAndRender(){
        const s = document.createElement('script');
        s.src = 'stock_data.js?v=' + new Date().getTime();
        s.onload = function(){
          try {
            if (typeof stockData !== 'undefined') {
              render(stockData);
            } else {
              document.getElementById('body').innerHTML = '<tr><td colspan="9">stockData not found in stock_data.js</td></tr>';
            }
          } catch(e){ document.getElementById('body').innerHTML = '<tr><td colspan="9">Error rendering: '+e+'</td></tr>' }
        };
        s.onerror = function(){ document.getElementById('body').innerHTML = '<tr><td colspan="9">Failed to load stock_data.js</td></tr>' };
        document.body.appendChild(s);
      }

      document.getElementById('refresh').addEventListener('click', loadAndRender);
      document.getElementById('q').addEventListener('input', function(){ if(window.debounce) clearTimeout(window.debounce); window.debounce = setTimeout(()=>{ if (typeof stockData !== 'undefined') render(stockData) },250); });
      document.getElementById('minStock').addEventListener('input', function(){ if (typeof stockData !== 'undefined') render(stockData) });

      loadAndRender();
    })();
  </script>
</body>
</html>
