<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIBAS - Smart Stock Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            overflow-x: hidden;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
        }
        
        /* Glass Morphism */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        /* Header Styles */
        .main-header {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 0;
            position: relative;
            overflow: hidden;
        }
        
        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Search Section */
        .search-hero {
            margin-top: -40px;
            position: relative;
            z-index: 10;
        }
        
        .search-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2.5rem;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Input Styles */
        .search-input {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(99, 102, 241, 0.1);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            background: white;
        }
        
        /* Button Styles */
        .btn-primary-custom {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 16px;
            padding: 1rem 2rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        
        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
        }
        
        /* Item Cards */
        .item-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.8));
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
        }
        
        .item-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .item-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                0 8px 30px rgba(0, 0, 0, 0.1);
        }
        
        .item-card:hover::before {
            transform: scaleX(1);
        }
        
        /* Price Tags */
        .price-tag {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.85rem;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .price-tag.sale {
            background: linear-gradient(135deg, var(--success), #059669);
        }
        
        .price-tag.wholesale {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }
        
        /* Stock Badge */
        .stock-badge {
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* Scanner Styles */
        #scanner-viewport {
            height: 180px !important;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: #000;
        }
        
        .scanner-line {
            position: absolute;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--success), transparent);
            top: 50%;
            animation: scan 1.5s infinite linear;
            box-shadow: 0 0 20px var(--success);
        }
        
        @keyframes scan {
            0% { top: 10%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 90%; opacity: 0; }
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Welcome Screen */
        .welcome-screen {
            text-align: center;
            padding: 4rem 2rem;
            color: white;
        }
        
        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            background: linear-gradient(135deg, #fff, #e2e8f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            height: 100%;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Status Indicators */
        .status-indicator {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            color: #10b981;
            font-weight: 600;
        }
        
        /* Loading Animation */
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .search-container {
                padding: 1.5rem;
                margin: 0 1rem;
            }
            
            .search-input {
                font-size: 1rem;
                padding: 0.875rem 1.25rem;
            }
            
            .btn-primary-custom {
                padding: 0.875rem 1.5rem;
            }
        }
        
        /* Custom Toggle Switch */
        .form-check-input:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .form-check-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-5 fw-bold text-white mb-2">
                        <i class="fas fa-warehouse me-3"></i>LIBAS Stock Manager
                    </h1>
                    <div class="d-flex align-items-center gap-3">
                        <span id="statusIndicator" class="status-indicator pulse">
                            <i class="fas fa-circle me-2"></i>
                            <span id="statusText">Loading...</span>
                        </span>
                        <span id="lastSync" class="text-white-50">Connecting...</span>
                    </div>
                </div>
                <div class="col-md-4 text-md-end">
                    <button class="btn btn-outline-light btn-sm" onclick="manualRefresh()">
                        <i class="fas fa-sync me-2"></i>Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Search Section -->
    <div class="container">
        <div class="search-hero">
            <div class="search-container glass-card fade-in-up">
                <div class="row align-items-center g-4">
                    <div class="col-lg-8">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text bg-transparent border-end-0 ps-3">
                                <i class="fas fa-search text-primary"></i>
                            </span>
                            <input type="text" id="searchInput" class="form-control search-input border-start-0" 
                                   placeholder="Search products by name, barcode, or category...">
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <button class="btn btn-primary-custom w-100 h-100 pulse" id="barcodeScannerBtn">
                            <i class="fas fa-camera me-2"></i>Scan Barcode
                        </button>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 id="itemCount" class="mb-0 text-muted fw-semibold">
                                <i class="fas fa-info-circle me-2"></i>Ready to search
                            </h5>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="showOutOfStock" checked>
                                <label class="form-check-label fw-medium" for="showOutOfStock">
                                    Show Out of Stock
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-5">
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="welcome-screen fade-in-up">
            <div class="welcome-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <h2 class="mb-4 fw-bold">Smart Stock Management</h2>
            <p class="lead mb-5 opacity-75">Real-time inventory tracking with instant barcode scanning</p>
            
            <div class="row justify-content-center g-4">
                <div class="col-md-4">
                    <div class="feature-card">
                        <i class="fas fa-bolt fa-2x text-warning mb-3"></i>
                        <h5 class="fw-bold mb-2">Instant Updates</h5>
                        <p class="opacity-75">Live data sync every 15 seconds</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <i class="fas fa-camera fa-2x text-success mb-3"></i>
                        <h5 class="fw-bold mb-2">Smart Scanner</h5>
                        <p class="opacity-75">Barcode scanning with instant results</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <i class="fas fa-mobile-alt fa-2x text-primary mb-3"></i>
                        <h5 class="fw-bold mb-2">Mobile Ready</h5>
                        <p class="opacity-75">Optimized for all devices</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- No Items Message -->
        <div id="noItemsMessage" class="text-center py-5 d-none">
            <div class="glass-card p-5 mx-auto" style="max-width: 400px;">
                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                <h4 class="text-dark mb-3">No Products Found</h4>
                <p class="text-muted">Try different search terms or scan a barcode</p>
            </div>
        </div>

        <!-- Items Container -->
        <div id="itemsContainer" class="d-none">
            <div class="row g-4" id="itemsList"></div>
        </div>
    </div>

    <!-- Barcode Scanner Modal -->
    <div class="modal fade" id="barcodeScannerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content glass-card border-0">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title text-dark fw-bold">
                        <i class="fas fa-barcode me-2"></i>Barcode Scanner
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Compact Scanner -->
                    <div id="scanner-viewport" class="position-relative">
                        <div class="scanner-line"></div>
                    </div>
                    
                    <!-- Scanner Status -->
                    <div id="scannerStatus" class="text-center mb-3">
                        <p class="text-muted mb-2">
                            <i class="fas fa-camera me-2"></i>Point camera at barcode
                        </p>
                    </div>
                    
                    <!-- Scan Results -->
                    <div id="scanResults" class="d-none">
                        <h6 class="text-center mb-3 fw-bold text-dark">Scan Results</h6>
                        <div id="scannedItemsList" class="row g-3"></div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-outline-secondary" id="switchCameraBtn">
                        <i class="fas fa-camera-rotate me-2"></i>Switch Camera
                    </button>
                    <button type="button" class="btn btn-danger" id="stopScannerBtn">
                        <i class="fas fa-stop me-2"></i>Stop Scanner
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentData = [];
        let quaggaInitialized = false;
        let currentFacingMode = 'environment';
        let scannerModal = null;
        let autoRefreshInterval;

        // Initialize the application
        async function initializeApp() {
            await loadData();
            setupBarcodeScanner();
            setupAutoRefresh();
            scannerModal = new bootstrap.Modal(document.getElementById('barcodeScannerModal'));
        }

        // Load data from GitHub - Optimized for speed
        async function loadData() {
            try {
                console.log('Loading data from GitHub...');
                
                // Use GitHub raw content without cache busting for faster loading
                const response = await fetch(`https://raw.githubusercontent.com/unique205/busywin-stock-data/main/stock_data.js`);
                
                if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                
                const jsCode = await response.text();
                
                // Clear previous data
                window.stockData = null;
                
                // Execute the JavaScript
                eval(jsCode);
                
                // Validate and use the data
                if (window.stockData && Array.isArray(window.stockData)) {
                    currentData = window.stockData;
                    const itemCount = currentData.length;
                    updateStatus(`Live - ${itemCount} items`, 'success');
                    console.log(`Successfully loaded ${itemCount} items`);
                    
                    // Update any active search
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput && searchInput.value) {
                        searchInput.dispatchEvent(new Event('input'));
                    }
                } else {
                    throw new Error('Invalid data format received');
                }
                
            } catch (error) {
                console.error('Error loading data:', error);
                updateStatus('Connection failed - retrying...', 'error');
                
                // Retry after 5 seconds on error
                setTimeout(loadData, 5000);
            }
        }

        // Setup auto-refresh every 15 seconds for faster updates
        function setupAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            autoRefreshInterval = setInterval(async () => {
                await loadData();
            }, 15000); // 15 seconds for faster updates
        }

        // Update status
        function updateStatus(message, type) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const lastSync = document.getElementById('lastSync');
            
            statusText.textContent = message;
            lastSync.textContent = `Last: ${new Date().toLocaleTimeString()}`;
            
            const colors = {
                success: 'rgba(16, 185, 129, 0.2)',
                error: 'rgba(239, 68, 68, 0.2)'
            };
            
            indicator.style.background = colors[type] || colors.success;
            indicator.style.borderColor = type === 'error' ? 'rgba(239, 68, 68, 0.3)' : 'rgba(16, 185, 129, 0.3)';
            indicator.style.color = type === 'error' ? '#ef4444' : '#10b981';
        }

        // Setup barcode scanner
        function setupBarcodeScanner() {
            const scannerBtn = document.getElementById('barcodeScannerBtn');
            const switchCameraBtn = document.getElementById('switchCameraBtn');
            const stopScannerBtn = document.getElementById('stopScannerBtn');

            scannerBtn.addEventListener('click', () => {
                scannerModal.show();
                setTimeout(initBarcodeScanner, 500);
            });

            switchCameraBtn.addEventListener('click', switchCamera);
            stopScannerBtn.addEventListener('click', stopBarcodeScanner);

            // Reset scanner when modal closes
            document.getElementById('barcodeScannerModal').addEventListener('hidden.bs.modal', () => {
                stopBarcodeScanner();
                document.getElementById('scanResults').classList.add('d-none');
                document.getElementById('scannedItemsList').innerHTML = '';
            });
        }

        // Initialize barcode scanner
        function initBarcodeScanner() {
            if (quaggaInitialized) {
                Quagga.start();
                return;
            }

            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-viewport'),
                    constraints: {
                        facingMode: currentFacingMode,
                        width: { min: 320 },
                        height: { min: 180 }
                    }
                },
                decoder: {
                    readers: ["code_128_reader", "ean_reader", "ean_8_reader", "code_39_reader", "upc_reader"]
                },
                locator: {
                    patchSize: "medium",
                    halfSample: true
                },
            }, function(err) {
                if (err) {
                    console.error('Error initializing Quagga:', err);
                    document.getElementById('scannerStatus').innerHTML = 
                        '<p class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Camera error</p>';
                    return;
                }
                quaggaInitialized = true;
                Quagga.start();
                document.getElementById('scannerStatus').innerHTML = 
                    '<p class="text-success"><i class="fas fa-check me-2"></i>Scanner active</p>';
            });

            Quagga.onDetected(function(result) {
                const code = result.codeResult.code;
                console.log('Barcode detected:', code);
                
                // Immediately search and display results
                const foundItems = searchByBarcode(code);
                
                if (foundItems.length > 0) {
                    displayScannedItems(foundItems);
                    document.getElementById('scannerStatus').innerHTML = 
                        `<p class="text-success"><i class="fas fa-check me-2"></i>Found ${foundItems.length} item(s)</p>`;
                } else {
                    document.getElementById('scannerStatus').innerHTML = 
                        `<p class="text-danger"><i class="fas fa-times me-2"></i>Not found: ${code}</p>`;
                }
            });
        }

        // Display scanned items in modal
        function displayScannedItems(items) {
            const resultsDiv = document.getElementById('scanResults');
            const itemsList = document.getElementById('scannedItemsList');
            
            itemsList.innerHTML = items.map(item => `
                <div class="col-12">
                    <div class="item-card p-4">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="fw-bold text-dark mb-2">${escapeHtml(item.ItemName)}</h6>
                                <div class="mb-3">
                                    <span class="badge bg-light text-dark me-2">
                                        <i class="fas fa-barcode me-1"></i>${escapeHtml(item.ItemAlias)}
                                    </span>
                                    <span class="badge bg-light text-dark">
                                        <i class="fas fa-tag me-1"></i>${escapeHtml(item.GroupName)}
                                    </span>
                                </div>
                                <div class="d-flex flex-wrap gap-2">
                                    <span class="price-tag">MRP: ₹${formatPrice(item.Item_MRP)}</span>
                                    <span class="price-tag sale">Sale: ₹${formatPrice(item.Item_Sale_Price)}</span>
                                    <span class="price-tag wholesale">WS: ₹${formatPrice(item.Item_SelfVal_Price)}</span>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <span class="stock-badge ${parseFloat(item.Stock) > 0 ? 'bg-success' : 'bg-danger'} text-white">
                                    <i class="fas fa-boxes me-1"></i>Stock: ${item.Stock}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            resultsDiv.classList.remove('d-none');
        }

        // Search by barcode
        function searchByBarcode(barcode) {
            const searchTerm = barcode.trim();
            return currentData.filter(item => 
                item.ItemAlias && item.ItemAlias.toString().trim() === searchTerm
            );
        }

        // Switch camera
        function switchCamera() {
            currentFacingMode = currentFacingMode === 'environment' ? 'user' : 'environment';
            stopBarcodeScanner();
            setTimeout(initBarcodeScanner, 500);
        }

        // Stop scanner properly
        function stopBarcodeScanner() {
            if (Quagga && quaggaInitialized) {
                Quagga.stop();
                quaggaInitialized = false;
            }
            document.getElementById('scannerStatus').innerHTML = 
                '<p class="text-muted"><i class="fas fa-pause me-2"></i>Scanner stopped</p>';
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const showOutOfStock = document.getElementById('showOutOfStock');
            
            const performSearch = () => {
                const searchTerm = searchInput.value.toLowerCase();
                const showAllStock = showOutOfStock.checked;
                
                let filteredItems = currentData;
                
                if (searchTerm) {
                    filteredItems = currentData.filter(item => 
                        (item.ItemName && item.ItemName.toLowerCase().includes(searchTerm)) ||
                        (item.ItemAlias && item.ItemAlias.toString().toLowerCase().includes(searchTerm)) ||
                        (item.GroupName && item.GroupName.toLowerCase().includes(searchTerm))
                    );
                }
                
                if (!showAllStock) {
                    filteredItems = filteredItems.filter(item => parseFloat(item.Stock) > 0);
                }
                
                displaySearchResults(filteredItems, searchTerm);
            };
            
            searchInput.addEventListener('input', performSearch);
            showOutOfStock.addEventListener('change', performSearch);
        }

        // Display search results
        function displaySearchResults(items, searchTerm) {
            const welcomeScreen = document.getElementById('welcomeScreen');
            const noItemsMessage = document.getElementById('noItemsMessage');
            const itemsContainer = document.getElementById('itemsContainer');
            const itemCount = document.getElementById('itemCount');
            
            if (searchTerm) {
                welcomeScreen.classList.add('d-none');
                
                if (items.length === 0) {
                    itemsContainer.classList.add('d-none');
                    noItemsMessage.classList.remove('d-none');
                    itemCount.innerHTML = `<i class="fas fa-search me-2"></i>No products found`;
                } else {
                    noItemsMessage.classList.add('d-none');
                    itemsContainer.classList.remove('d-none');
                    renderItems(items);
                    itemCount.innerHTML = `<i class="fas fa-check me-2"></i>Found ${items.length} product(s)`;
                }
            } else {
                welcomeScreen.classList.remove('d-none');
                itemsContainer.classList.add('d-none');
                noItemsMessage.classList.add('d-none');
                itemCount.innerHTML = `<i class="fas fa-info-circle me-2"></i>Ready to search`;
            }
        }

        // Render items list
        function renderItems(items) {
            const container = document.getElementById('itemsList');
            
            container.innerHTML = items.map(item => `
                <div class="col-lg-6 col-xl-4">
                    <div class="item-card p-4 h-100">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h6 class="fw-bold text-dark mb-0 flex-grow-1">${escapeHtml(item.ItemName)}</h6>
                            <span class="stock-badge ${parseFloat(item.Stock) > 0 ? 'bg-success' : 'bg-danger'} text-white ms-2">
                                ${item.Stock} in stock
                            </span>
                        </div>
                        
                        <div class="mb-3">
                            <span class="badge bg-light text-dark me-2 mb-2">
                                <i class="fas fa-barcode me-1"></i>${escapeHtml(item.ItemAlias)}
                            </span>
                            <span class="badge bg-light text-dark mb-2">
                                <i class="fas fa-tag me-1"></i>${escapeHtml(item.GroupName)}
                            </span>
                        </div>
                        
                        <div class="d-flex flex-column gap-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted">MRP:</span>
                                <span class="fw-bold text-primary">₹${formatPrice(item.Item_MRP)}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted">Sale Price:</span>
                                <span class="fw-bold text-success">₹${formatPrice(item.Item_Sale_Price)}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted">Wholesale:</span>
                                <span class="fw-bold text-warning">₹${formatPrice(item.Item_SelfVal_Price)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Utility functions
        function formatPrice(price) {
            return parseFloat(price || 0).toFixed(2);
        }

        function escapeHtml(unsafe) {
            return unsafe.toString()
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Manual refresh
        window.manualRefresh = function() {
            loadData();
            const searchInput = document.getElementById('searchInput');
            if (searchInput.value) {
                searchInput.dispatchEvent(new Event('input'));
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupSearch();
        });
    </script>
</body>
</html>